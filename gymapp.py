import streamlit as st
import pandas as pd

# 1. 页面设置
st.set_page_config(page_title="全能健身 Pro", page_icon="🔥", layout="wide")

# 2. 核心逻辑：生成计划
def get_plan_data(goal):
    if goal == "减脂":
        # 饮食建议 (拆分短句防止报错)
        tips = [
            "早餐: 燕麦(40g) + 鸡蛋(1个) + 牛奶",
            "午餐: 杂粮饭 + 鸡胸肉 + 大量蔬菜",
            "晚餐: 玉米 + 鱼肉 + 凉拌菜",
            "加餐: 苹果 或 蓝莓"
        ]
        # 训练动作
        acts = [
            ["热身", "开合跳", "2组", "30秒"],
            ["力量", "深蹲", "4组", "20次"],
            ["力量", "俯卧撑", "4组", "力竭"],
            ["力量", "划船", "4组", "15次"],
            ["有氧", "爬坡快走", "1次", "35分钟"]
        ]
        advice = "核心策略：制造热量缺口，保持微饿感。"
        
    elif goal == "增肌":
        tips = [
            "早餐: 全麦面包 + 2个鸡蛋 + 香蕉",
            "午餐: 大份米饭 + 牛肉 + 蔬菜",
            "晚餐: 意面 + 鱼虾 + 沙拉",
            "加餐: 蛋白粉 + 吐司"
        ]
        acts = [
            ["热身", "肩部激活", "2组", "15次"],
            ["胸部", "卧推", "4组", "10次"],
            ["背部", "高位下拉", "4组", "12次"],
            ["腿部", "深蹲", "4组", "10次"],
            ["核心", "卷腹", "3组", "20次"]
        ]
        advice = "核心策略：热量盈余，大重量训练。"
        
    else: # 维持
        tips = [
            "早餐: 正常碳水 + 蛋白质",
            "午餐: 均衡饮食，七分饱",
            "晚餐: 少油少盐，少主食",
            "加餐: 酸奶 + 坚果"
        ]
        acts = [
            ["激活", "动态拉伸", "1组", "5分钟"],
            ["全身", "波比跳", "3组", "10次"],
            ["下肢", "箭步蹲", "3组", "15次"],
            ["上肢", "俯卧撑", "3组", "15次"],
            ["有氧", "慢跑", "1次", "20分钟"]
        ]
        advice = "核心策略：改善体态，关注动作质量。"

    df = pd.DataFrame(acts, columns=["板块", "动作", "组数", "计划"])
    return tips, df, advice

# 3. 核心逻辑：进度分析 (拆分计算步骤)
def check_progress(cur_w, last_w, cur_waist, last_waist, goal):
    # 先算出数值，保留1位小数
    w_diff = round(cur_w - last_w, 1)
    waist_diff = round(cur_waist - last_waist, 1)
    
    msg = ""
    status = "normal"
    
    if goal == "减脂":
        if w_diff < 0:
            # 使用简单的字符串拼接，防止f-string报错
            val = abs
