import streamlit as st
import pandas as pd

# --- é¡µé¢é…ç½® ---
st.set_page_config(page_title="ç§äººå¥èº«è®¡åˆ’åŠ©æ‰‹ Pro", page_icon="ğŸ’ª", layout="wide")

# --- æ ¸å¿ƒé€»è¾‘å‡½æ•° ---
def calculate_bmr(gender, weight, height, age):
    if gender == 'ç”·':
        return (10 * weight) + (6.25 * height) - (5 * age) + 5
    else:
        return (10 * weight) + (6.25 * height) - (5 * age) - 161

def get_tdee(bmr, activity_level):
    levels = {
        "ä¹…å (å‡ ä¹ä¸è¿åŠ¨)": 1.2,
        "è½»åº¦æ´»è·ƒ (æ¯å‘¨1-3æ¬¡è¿åŠ¨)": 1.375,
        "ä¸­åº¦æ´»è·ƒ (æ¯å‘¨3-5æ¬¡è¿åŠ¨)": 1.55,
        "éå¸¸æ´»è·ƒ (æ¯å‘¨6-7æ¬¡è¿åŠ¨)": 1.725,
        "è¶…çº§æ´»è·ƒ (ä½“åŠ›å·¥ä½œ+é«˜å¼ºåº¦è®­ç»ƒ)": 1.9
    }
    return bmr * levels[activity_level]

def generate_macros(goal, tdee, weight):
    if goal == "å‡è„‚":
        target = tdee - 500
        prot = weight * 2.0
        fat = weight * 0.8
    elif goal == "å¢è‚Œ":
        target = tdee + 300
        prot = weight * 2.2
        fat = weight * 1.0
    else:
        target = tdee
        prot = weight * 1.8
        fat = weight * 0.9
    
    carb = (target - prot*4 - fat*9) / 4
    return int(target), int(prot), int(fat), int(carb)

# --- ç”Ÿæˆå…·ä½“é£Ÿè°± ---
def get_detailed_diet(calories, goal):
    # ç®€å•é€»è¾‘ï¼šæ ¹æ®çƒ­é‡æ¡£ä½æ¨èé£Ÿè°±
    if calories < 1600:
        plan_type = "ä½çƒ­é‡ (å‡è„‚)"
        menu = {
            "æ—©é¤": "æ— ç³–ç‡•éº¦ç‰‡(40g) + æ°´ç…®è›‹(1ä¸ª) + è„±è„‚ç‰›å¥¶(200ml)",
            "åˆé¤": "æ‚ç²®é¥­(100g) + é¸¡èƒ¸è‚‰(150g) + è¥¿å…°èŠ±(200g)",
            "æ™šé¤": "ç‰ç±³(1æ ¹) + è’¸é±¼/è™¾(100g) + å‡‰æ‹Œé»„ç“œ",
            "åŠ é¤": "ä¸€ä¸ªå°è‹¹æœ æˆ– è“è“(100g)"
        }
    elif calories < 2200:
        plan_type = "ä¸­çƒ­é‡ (å‡è¡¡)"
        menu = {
            "æ—©é¤": "å…¨éº¦é¢åŒ…(2ç‰‡) + ç…è›‹(2ä¸ª) + çº¯ç‰›å¥¶(250ml)",
            "åˆé¤": "ç±³é¥­(150g) + ç˜¦ç‰›è‚‰(150g) + ç‚’æ—¶è”¬(200g)",
            "æ™šé¤": "çº¢è–¯(200g) + é¸¡è…¿è‚‰(å»çš®150g) + è”¬èœæ±¤",
            "åŠ é¤": "æ— ç³–é…¸å¥¶(1æ¯) + åšæœ(10g)"
        }
    else:
        plan_type = "é«˜çƒ­é‡ (å¢è‚Œ)"
        menu = {
            "æ—©é¤": "ç‡•éº¦ç²¥(80g) + å…¨è›‹(3ä¸ª) + å…¨è„‚ç‰›å¥¶(300ml) + é¦™è•‰",
            "åˆé¤": "ç±³é¥­(250g) + ç‰›æ’/è‚¥ç‰›(200g) + ä»»æ„è”¬èœ",
            "æ™šé¤": "æ„é¢(200g) + é±¼è‚‰(200g) + è”¬èœæ²™æ‹‰(åŠ æ©„æ¦„æ²¹)",
            "åŠ é¤": "è›‹ç™½ç²‰(1å‹º) + åå¸(2ç‰‡) + èŠ±ç”Ÿé…±"
        }
    return plan_type, menu

# --- ç”Ÿæˆå…·ä½“è®­ç»ƒè¡¨ ---
def get_workout_plan(goal, gender):
    if goal == "å‡è„‚":
        focus = "å…¨èº«å¾ªç¯ + æœ‰æ°§"
        df = pd.DataFrame([
            ["çƒ­èº«", "å¼€åˆè·³/é«˜æŠ¬è…¿", "2ç»„", "30ç§’", "æ— "],
            ["åŠ›é‡ A", "å¾’æ‰‹æ·±è¹² / å“‘é“ƒæ·±è¹²", "4ç»„", "15-20æ¬¡", "60ç§’"],
            ["åŠ›é‡ B", "ä¿¯å§æ’‘ (è·ªå§¿)", "4ç»„", "åŠ›ç«­", "60ç§’"],
            ["åŠ›é‡ C", "å“‘é“ƒåˆ’èˆ¹ / å¼¹åŠ›å¸¦åˆ’èˆ¹", "4ç»„", "15æ¬¡", "60ç§’"],
            ["æ ¸å¿ƒ", "å¹³æ¿æ”¯æ’‘", "3ç»„", "45ç§’", "30ç§’"],
            ["æœ‰æ°§", "å¿«èµ°/çˆ¬å¡/è·³ç»³", "1æ¬¡", "30-40åˆ†é’Ÿ", "ä¿æŒå¿ƒç‡130+"]
        ], columns=["æ¿å—", "åŠ¨ä½œ", "ç»„æ•°", "æ¬¡æ•°/æ—¶é•¿", "ç»„é—´ä¼‘æ¯"])
        
    elif goal == "å¢è‚Œ":
        focus = "å¤§é‡é‡åˆ†åŒ–è®­ç»ƒ"
        df = pd.DataFrame([
            ["çƒ­èº«", "è‚©è¢–æ¿€æ´» + ç©º
